= content_for :title, (params[:id] == 'all' ? "Map of all funding in 2014" : "Map of #{@funder.name} in #{@funder.current_attribute.year}")

%script{:src => "https://api.mapbox.com/mapbox.js/v2.2.2/mapbox.js"}
%link{:href => "https://api.mapbox.com/mapbox.js/v2.2.2/mapbox.css", :rel => "stylesheet"}

%script{:src => "https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/leaflet.markercluster.js"}
%link{:href => "https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.css", :rel => "stylesheet"}
%link{:href => "https://api.tiles.mapbox.com/mapbox.js/plugins/leaflet-markercluster/v0.4.0/MarkerCluster.Default.css", :rel => "stylesheet"}

= javascript_include_tag 'map'

:css
  html, body {
    min-height: 100% !important;
    height: 100%;
  }
  #map-buttons {
    position: absolute;
    top: 10px;
    right: 75px;
    z-index: 999;
  }
  .info {
    position: absolute;
    top: 50px;
    right: 75px;
    z-index: 999;
  }
  .info div {
    background: #fafafa;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 3px;
    width: 200px;
    height: 100%;
  }

= render partial: 'funders/funding/subnav'

.full-height.map.uk-animation-fade
  .full-height-content
    - if params[:id] == 'all' || @funder.districts.any?

      #map
        #map-buttons{"data-uk-button-radio" => ""}
          %button.uk-button.uk-button-small.uk-button-primary.uk-active#all{"data-uk-tooltip" => "{pos:'top'}", :title => "Colour map by the amount of funding awarded."} Amount given
          %button.uk-button.uk-button-small.uk-button-primary#count{"data-uk-tooltip" => "{pos:'top'}", :title => "Colour map by the number of grants awarded."} No. of grants
          %button.uk-button.uk-button-small.uk-button-primary#rank{"data-uk-tooltip" => "{pos:'top'}", :title => "Colour map by the amount of highly deprived residents."} IMD rank
        #info.info
        .cta{style: 'margin: 10%;'}
          %strong Map loading...
          .uk-progress.uk-progress-striped.uk-active
            .uk-progress-bar{:style => "width: 100%;"}
    - else
      .cta.red
        %strong Sorry, missing information.
        %br
          It looks like we don't have suitable location data for
          = succeed '.' do
            = @funder.name
          %strong= link_to 'Get in touch', 'mailto:support@beehivegiving.org', class: 'blue'
          if you think this is a mistake.
