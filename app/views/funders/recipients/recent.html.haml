= content_for :title, "Recent funding proposals for #{@funder.name}"

%script{:src => "https://api.mapbox.com/mapbox.js/v2.2.2/mapbox.js"}
%link{:href => "https://api.mapbox.com/mapbox.js/v2.2.2/mapbox.css", :rel => "stylesheet"}

= render partial: 'funders/recipients/subnav'

.uk-container.uk-container-center.uk-margin-large

  = render partial: 'funders/prototype'

  %h2 Recent funding proposals
  %h4 You are seeing recent proposals that Beehive thinks would be suitable for you.

  .uk-width-large-4-5.uk-container-center.uk-margin-large-top.uk-animation-fade

    .uk-width-1-1.uk-margin-bottom.uk-text-right

      %strong Sort:

      %a.blue{"data-uk-tooltip" => "{pos:'top'}", :title => "Coming soon"}
        %strong Date
        %i.uk-icon.uk-icon-caret-down

      %span &middot;

      %a.blue{"data-uk-tooltip" => "{pos:'top'}", :title => "Coming soon"}
        Amount

      |

      %strong Filter:

      %a.blue{"data-uk-tooltip" => "{pos:'top'}", :title => "Coming soon"}
        Location

    - @recipients.each do |recipient|
      - if recipient.proposals.count > 0
        %hr.thick
        .uk-grid
          .uk-width-medium-1-3
            .card
              .details
                .content
                  %h3= link_to recipient.name, '#', class: 'blue', style: 'font-size: 18px;', "data-uk-tooltip" => "{pos:'top'}", :title => "Coming soon"
                %hr

              - if recipient.charity_number.present? || recipient.company_number.present?
                .details
                  .content.center
                    .uk-grid.uk-grid-small
                      .uk-width-1-2
                        - if recipient.charity_number.present?
                          %strong Charity No.
                          = recipient.charity_number
                      .uk-width-1-2
                        - if recipient.company_number.present?
                          %strong Company No.
                          = recipient.company_number
                  %hr

              .details
                .content
                  %i.uk-icon.uk-icon-map-marker
                  = Country.find_by_alpha2(recipient.country).name
                  - if recipient.website.present?
                    .uk-float-right
                      %a.blue{href: recipient.website, target: '_blank', "data-uk-tooltip" => "{pos:'top'}", :title => "Opens in a new window."}
                        %i.uk-icon.uk-icon-globe
                        Website
                %hr

              .details
                .content.center
                  .uk-button.uk-button-large.uk-button-primary{"data-uk-tooltip" => "{pos:'top'}", :title => "Coming soon"}
                    Connect
                    -# %i.uk-icon.uk-icon-cube
                  .uk-button.uk-button-large.uk-button-primary.invert{"data-uk-tooltip" => "{pos:'top'}", :title => "Download summary (coming soon)"}
                    %i.uk-icon.uk-icon-download
                  .uk-button.uk-button-large.uk-button-primary.invert{"data-uk-tooltip" => "{pos:'top'}", :title => "Print summary (coming soon)"}
                    %i.uk-icon.uk-icon-print

          .uk-width-medium-2-3
            %h3.uk-margin-top
              = link_to recipient.proposals.first.title, '#', class: 'blue', "data-uk-tooltip" => "{pos:'top'}", :title => "Coming soon"
              %span.year.muted
                = time_ago_in_words(recipient.proposals.first.created_at)
                ago
            -# %p= some_scope.tagline
            %p= recipient.proposals.first.tagline

            = render partial: 'funders/recipients/data_table', locals: {recipient: recipient}

            %ul.insights
              %li{ class: (recipient.eligible?(@funder) ? 'eligible' : 'ineligible')}
                - if recipient.eligible?(@funder)
                  %a.badge.no-click Eligible
                  Eligible for
                  = succeed '.' do
                    %strong= recipient.enquiries.where(funder_id: @funder.id).first.funding_stream
              %li
                Also suggested to
                = succeed '.' do
                  %strong= recipient.recommended_funders.pluck(:name).reject {|i| i == @funder.name}.take(3).to_sentence
              -# %li
              -#   Interested in
              -#   = succeed '.' do
              -#     %strong= recipient.enquiries.first.funding_stream
              -#   -# Also interested in other funders?
              -# %li
              -#   Visited your website
              -#   %strong= recipient.enquiries.first.approach_funder_count
              -#   time(s).
              %li
                - if recipient.proposals.first.beneficiaries.where(category: 'People').pluck(:label).count > 0
                  Seeking funds to affect people
                  = succeed '.' do
                    %strong= recipient.proposals.first.beneficiaries.where(category: 'People').pluck(:label).to_sentence.downcase
                - if recipient.proposals.first.beneficiaries.where(category: 'Other').pluck(:label).count > 0
                  As well as
                  = succeed '.' do
                    %strong= recipient.proposals.first.beneficiaries.where(category: 'Other').pluck(:label).to_sentence.downcase
              %li
                Seeking funds to affect
                = succeed '.' do
                  %strong= recipient.proposals.first.districts.pluck(:district).to_sentence
              - if recipient.grants.count > 0
                %li
                  %strong= recipient.grants.last.funder.name
                  awarded
                  = recipient.name
                  %strong= number_to_currency(recipient.grants.last.amount_awarded, unit: '£', precision: 0)
                  in
                  = succeed '.' do
                    %strong= recipient.grants.last.approved_on.strftime('%Y')
              %li
                Seeking
                %strong= number_to_currency(recipient.proposals.first.total_costs, unit: '£', precision: 0)
                over
                %strong= recipient.proposals.first.funding_duration
                month(s).
              %li
                %strong= number_to_percentage((recipient.load_recommendation(@funder).grant_amount_recommendation * 100), precision: 0)
                of funding was similar to the
                %strong amount
                sought.
              %li
                %strong= number_to_percentage((recipient.load_recommendation(@funder).grant_duration_recommendation * 100), precision: 0)
                of funding was similar to the
                %strong duration
                sought.

            %div.uk-margin-top.shadow{style: 'border: 1px solid #ddd; border-radius: 3px; padding: 10px; color: #333; font-size: 14px; background: white;', "data-uk-tooltip" => "{pos:'top'}", :title => "Coming soon"}
              %h4.uk-text-bold Coming soon
              %ul.insights
                %li Previously funded by

            %div.uk-margin-top.shadow{style: 'border: 1px solid #ddd; border-radius: 3px; padding: 10px; color: #333; font-size: 14px; background: white;', "data-uk-tooltip" => "{pos:'top'}", :title => "Coming soon"}
              %h4.uk-text-bold Improve your recommendations and help Beehive learn
              Was this proposal suitable?
              .uk-button.uk-button-small.uk-button-primary Yes
              .uk-button.uk-button-small.uk-button-primary No
