= content_for :title, "More info for #{@fund.name}"

:javascript
  mixpanel.track("View Fund Page", { "Fund": "#{@fund.name}" });

= render partial: 'fund_subnav', locals: { fund: @fund }

.uk-container.uk-container-center.uk-margin-large.uk-margin-large-top
  .uk-margin-large-bottom
    = cell(:fund_insight, @fund, proposal: @proposal).call(:title)

  .uk-grid
    .uk-width-medium-1-3
      = render partial: 'card', locals: { fund: @fund }

    .uk-width-medium-2-3
      %section
        %h3.uk-margin-top
          Summary

        = render partial: 'insights', locals: { fund: @fund }

        = cell(:fund_insight, @fund, proposal: @proposal).call(:themes)

        %hr.thick

      %section
        %h3.uk-margin-top
          Eligibility

        %h4.uk-margin-top
          Location

        .cta.green
          Eligible

        %h4.uk-margin-top
          Grant amount

        .cta.green
          Eligible

        %h4.uk-margin-top
          Organisation type

        .cta.green
          Eligible

        %h4.uk-margin-top.uk-text-success
          Eligibility questions
        %p.uk-margin-bottom
          The following questions have been set by
          = succeed ',' do
            = @fund.funder.name
          complete them to see if you are eligible for their
          = link_to @fund.short_name, proposal_fund_path(@proposal, @fund)
          fund.


        %h3.uk-text-bold Are you seeking funding for?
        .uk-form.uk-form-stacked
          = simple_form_for :check, url: eligibility_proposal_fund_path(@proposal, @fund), method: :patch do |f|

            - if ensure_restriction_category('Organisation')
              %h4.uk-text-bold About your organisation
              = f.simple_fields_for @recipient do |r|
                = r.simple_fields_for :eligibilities, @org_criteria do |e|
                  - if ensure_fund_restriction(e)
                    .uk-width-1-1.recipient_restriction.recipient_restriction
                      .restrictions
                        .restriction
                          %label.capitalize
                            = succeed '?' do
                              = raw(render_restriction_details(e))
                        .answer
                          = e.hidden_field :restriction_id
                          = e.input :eligible, as: :radio_buttons, collection: render_restriction_radio_buttons(e)
                          - if e.object.eligible == false && @recipient.valid? && @proposal.checked_fund?(@fund)
                            .restriction-error-message You did not meet this criteria
                        %hr

            - if ensure_restriction_category('Proposal')
              %h4.uk-text-bold About your funding proposal
              = f.simple_fields_for @proposal do |proposal|
                = proposal.simple_fields_for :eligibilities, @proposal_criteria do |e|
                  - if ensure_fund_restriction(e)
                    .uk-width-1-1.proposal_restriction
                      .restrictions
                        .restriction
                          %label.capitalize
                            = succeed '?' do
                              = raw(render_restriction_details(e))
                        .answer
                          = e.hidden_field :restriction_id
                          = e.input :eligible, as: :radio_buttons, collection: render_restriction_radio_buttons(e)
                          - if e.object.eligible == false && @recipient.valid? && @proposal.checked_fund?(@fund)
                            .restriction-error-message You did not meet this criteria
                        %hr

            - if @proposal.checked_fund?(@fund)
              = f.button :button, 'Update', class: 'uk-button uk-button-primary uk-button-large uk-width-large-2-5 uk-float-right', data: {disable_with: "<i class='uk-icon uk-icon-circle-o-notch uk-icon-spin'></i> Updating..."}
            - else
              = f.button :button, check_eligibility_button_copy, class: 'uk-button uk-button-primary uk-button-large uk-width-large-2-5 uk-float-right', data: {disable_with: "<i class='uk-icon uk-icon-circle-o-notch uk-icon-spin'></i> Checking..."}, "data-uk-tooltip" => "{pos:'top'}", :title => "This will use one of your free eligibility checks."

        %hr.thick

      %section#how-was-funding-distributed.offset
        %h3.uk-margin-top
          How was funding distributed?
          = period

        - if @fund.open_data?
          %p
            Awarded
            %span.uk-text-bold= number_with_delimiter(@fund.grant_count)
            = "grant".pluralize(@fund.grant_count) + '.'

          #amount_awarded_distribution.chart{ data: { data: amount_awarded_distribution } }

        - else
          = render partial: 'not_enough_data'

        %hr.thick

      %section#when-was-funding-awarded.offset
        %h3.uk-margin-top
          When was funding awarded?
          = period

        - if @fund.open_data? && @fund.award_month_distribution?
          %p
            Awarded the most funding in
            = succeed '.' do
              %strong= top_award_months

          #award_month_distribution.chart{ data: { data: award_month_distribution } }

        - else
          = render partial: 'not_enough_data'

        %hr.thick

      %section#where-was-funding-awarded.offset
        %h3.uk-margin-top
          Where was funding awarded?
          = period

        - if @fund.open_data? && @fund.country_distribution?
          %p
            Awarded most funding in the
            = succeed '.' do
              %strong= top_countries

          = geo_chart country_distribution, id: 'country_distribution', library: { colorAxis: { colors: ['#f5e8c4', '#fadc89', '#f5b918'] }, tooltip: { textStyle: { color: '#353f45' } } }

        - else
          = render partial: 'not_enough_data'

      - unless @proposal.checked_fund?(@fund)
        .cta.wide
          See if you are eligible for funding.
          %a.uk-button.uk-button-large.uk-button-primary.invert{ href: eligibility_proposal_fund_path(@proposal, @fund) } Check eligibility
