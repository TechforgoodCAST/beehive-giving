= content_for :title, "More info for #{@fund.name}"

= stylesheet_link_tag 'overrides/morris_overrides'
= javascript_include_tag 'raphael'
= javascript_include_tag 'morris'
= javascript_include_tag '//www.google.com/jsapi', 'chartkick'

:javascript
  mixpanel.track("View Fund Page", {"Fund": "#{@fund.name}"});

= render partial: 'subnav', locals: {fund: @fund}

.uk-container.uk-container-center.uk-margin-large.uk-margin-large-top.uk-animation-fade
  .uk-grid
    .uk-width-medium-1-3
      = render partial: 'recipients/funders/card', locals: { fund: @fund }

    .uk-width-medium-2-3
      %section
        %h3.uk-margin-top
          Summary
          -# %span.year.muted
          -#   in
          -#   = @fund.year_of_fund

        = render partial: 'recipients/funders/insights', locals: {fund: @fund}

        -# TODO: refactor DRY see _summary.html.haml
        - if @fund.tag_list.present?
          .uk-margin-top
            - if @recipient.recommended_fund?(@fund) || @proposal.recommendation(@fund).eligibility?
              = raw @fund.tags.order(:name).map { |t| link_to t, tag_path(t.slug), class: 'uk-button uk-button-small uk-button-primary invert uk-margin-small-bottom' }.join(' ')
            - else
              .uk-margin-small-bottom
                %a{href: '#why-hidden', class: 'uk-text-bold', onclick: '$.UIkit.modal("#why-hidden").show();'} Upgrade to see funding themes (coming soon)
              = raw @fund.tags.order(:name).map { |t| link_to scramble_name(t.name), '#why-hidden', class: 'uk-button uk-button-small uk-button-primary invert uk-margin-small-bottom redacted', onclick: '$.UIkit.modal("#why-hidden").show();' }.join(' ')


        %hr.thick

      %section#how-was-funding-distributed.offset
        %h3.uk-margin-top
          How was funding distributed?
          -# %span.year.muted
          -#   in
          -#   = @fund.year_of_fund

        %p
          Awarded
          %span.uk-text-bold= number_with_delimiter(@fund.grant_count)
          grants.

        #funding_frequency_distribution.chart{ data: { data: amount_awarded_distribution } }

        %hr.thick

      - if @fund.award_month_distribution
        %section#when-was-funding-awarded.offset
          %h3.uk-margin-top
            When was funding awarded?
            -# %span.year.muted
            -#   in
            -#   = @fund.year_of_fund

          %p
            Awarded funding in
            -# = succeed '.' do
            -#   %strong= raw(@funder.current_attribute.approval_months_by_count)

          #funding_by_month.chart{ data: { data: award_month_distribution } }

        %hr.thick

      %section#where-was-funding-awarded.offset
        %h3.uk-margin-top
          Where was funding awarded?
          -# %span.year.muted
          -#   in
          -#   = @fund.year_of_fund

        - if @fund.country_distribution
          %p
            The most funded countries were
            -# = succeed '.' do
            -#   %strong= raw(@funder.current_attribute.countries_by_count)

        = geo_chart country_distribution, library: {colorAxis: {colors: ['#f5e8c4', '#fadc89', '#f5b918']}, tooltip: {textStyle: {color: '#353f45'}}}

      -# TODO: 
      -# - if @recipient.can_unlock_funder?(@funder) && !@recipient.load_recommendation(@funder).eligibility
      -#   .cta.wide
      -#     See if you are eligible for funding.
      -#     %a.uk-button.uk-button-large.uk-button-primary.invert{href: recipient_eligibility_path(@funder)} Check eligibility

= render partial: 'funders/why_hidden'
