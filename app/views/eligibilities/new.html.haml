= content_for :title, "Eligibility for #{@fund.name}"

:javascript
  mixpanel.track("View Eligibility Page", {"Fund": "#{@fund.name}"});
  mixpanel.identify('#{current_user.id}');
  mixpanel.people.set({
    'Fund Unlocks': '#{@recipient.funds_checked}',
  });

- if @recipient.unlocked_fund?(@fund)
  :javascript
    mixpanel.people.set({
      'Last Unlocked Fund': '#{@recipient.unlocked_funds.last.name}',
      'Last Fund Eligibility': '#{@recipient.proposals.last.eligible?(@recipient.unlocked_funds.last)}',
      'Eligibility #{@fund.slug}': '#{@recipient.proposals.last.eligible?(@fund)}'
    });

= render partial: 'funds/subnav', locals: { fund: @fund }

.uk-container.uk-container-center.uk-margin-large.uk-margin-large-top.uk-animation-fade
  .uk-grid
    .uk-width-medium-1-3
      = render partial: 'recipients/funders/card', locals: { fund: @fund }

    .uk-width-medium-2-3
      - if @proposal.recommendation(@fund).eligibility
        - if @proposal.eligible?(@fund)
          .cta.wide.green
            You are eligible for the
            = @fund.short_name
            fund.
            = link_to 'Apply for funding', fund_apply_path(@fund), class: 'uk-button uk-button-large uk-button-success invert'
        - else
          .cta.wide.red
            You are ineligible, and did not meet
            %strong= @recipient.ineligible_restrictions.count
            of the criteria below.

      %h3.uk-margin-top Eligibility questions
      %p.uk-margin-bottom
        The following questions have been set by
        = succeed ',' do
          = @fund.funder.name
        complete them to see if you are eligible for their
        = link_to @fund.short_name, fund_path(@fund)
        fund.

      %hr.thick

      %h4.uk-text-bold Are you seeking funding for?
      .uk-form.uk-form-stacked
        = simple_form_for @recipient, url: fund_eligibility_path(@fund) do |f|
          = f.simple_fields_for :eligibilities, @criteria do |e|
            - if @fund.restrictions.pluck(:restriction_id).include?(e.object.restriction_id) # TODO: refactor
              = render partial: 'recipients/restriction', locals: {e: e}
          - if @proposal.recommendation(@fund).eligibility
            = f.button :button, 'Update', class: 'uk-button uk-button-primary uk-button-large uk-width-large-2-5 uk-float-right', data: {disable_with: "<i class='uk-icon uk-icon-circle-o-notch uk-icon-spin'></i> Updating..."}
          - else
            = f.button :button, "Check eligibility (#{(Recipient::MAX_FREE_LIMIT - @recipient.funds_checked)} left)", class: 'uk-button uk-button-primary uk-button-large uk-width-large-2-5 uk-float-right', data: {disable_with: "<i class='uk-icon uk-icon-circle-o-notch uk-icon-spin'></i> Checking..."}, "data-uk-tooltip" => "{pos:'top'}", :title => "This will use one of your free eligibility checks."
