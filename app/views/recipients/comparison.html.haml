.uk-width-1-1.uk-hidden-large
  %ul.uk-tab{"data-uk-tab" => "{connect:'#tab-content'}", "data-uk-sticky" => "{top:42}"}
    %li.uk-width-1-1
      %a{:href => ""} Overview
    %li
      %a{:href => ""} Organisation
    %li
      %a{:href => ""} Beneficiaries
    %li
      %a{:href => ""} Team
    %li
      %a{:href => ""} Work
    %li.uk-tab-responsive.uk-active.uk-hidden
      .uk-dropdown
        %ul.uk-nav.uk-nav-dropdown

.uk-grid.uk-grid-small
  .uk-width-1-4.uk-hidden-small.uk-hidden-medium
    .uk-width-1-1{"data-uk-sticky" => "{top:42}"}
      .uk-panel.uk-panel-box{style: "padding-top: 0;"}
        %ul.uk-nav.uk-nav-side

          %li.uk-parent{"data-uk-dropdown" => "{mode:'click'}"}
            .uk-dropdown{style: 'top: -5px; left: 100%; padding-bottom: 0;'}
              %ul.uk-nav.uk-nav-side#padding-remove
                %li.uk-nav-header
                  Unlocked funders
                - @recipient.unlocked_funders.each do |funder|
                  %li
                    = link_to funder.name, recipient_comparison_path(funder), style: 'padding: 7px 15px;'
                -# %a.uk-button.uk-button-large.uk-button-primary.uk-width-1-1{style: 'color: #fff;'}
                -#   %i.uk-icon-lock
                -#     Unlock more...
            %a.uk-text-center.uk-vertical-align{style: 'height: 75px;'}
              .uk-vertical-align-middle
                = image_tag "logos/#{@funder.slug}-logo.png", alt: "#{@funder.name}"

        %ul.uk-nav.uk-nav-side{"data-uk-tab" => "{connect:'#tab-content'}"}
          %li
            %a
              %span.uk-text-bold Overview
              %div
                Summery details of
                = @funder.name.pluralize
                funding.
          %li
            %a
              %span.uk-text-bold Organisation
              %div Location, age, and income of funded organisations.
          %li
            %a
              %span.uk-text-bold Beneficiaries
              %div Age range, gender, and state of the people funded organisations support.
          %li
            %a
              %span.uk-text-bold Team
              %div Number of volunteers, staff, and departments of funded organisations.
          %li
            %a
              %span.uk-text-bold Work
              %div How funded organisations implement their work.

        .uk-text-bold View data for:
        .uk-button-group.uk-width-1-1.uk-margin{"data-uk-button-radio" => ""}
          = link_to '1 year', params.merge(:years_ago => 1), class: @years_ago == 1 ? 'uk-button uk-active uk-width-1-3' : 'uk-button uk-width-1-3'
          = link_to '2 years', params.merge(:years_ago => 2), class: @years_ago == 2 ? 'uk-button uk-active uk-width-1-3' : 'uk-button uk-width-1-3'
          = link_to '3 years', params.merge(:years_ago => 3), class: @years_ago == 3 ? 'uk-button uk-active uk-width-1-3' : 'uk-button uk-width-1-3'
        .uk-text-bold Viewing funding stream:
        %ul.uk-nav.uk-nav-side
          %li.uk-parent{"data-uk-dropdown" => "{mode:'click'}"}
            .uk-dropdown{style: 'top: 50%; left: 100%; padding-bottom: 0; padding-top: 0;'}
              %ul.uk-nav.uk-nav-side#padding-remove
                %li
                  %li
                    = link_to 'All', params.merge(:funding_stream => nil), style: 'padding: 7px 15px;'
                - Grant.where('funder_id = ?', @funder).uniq.pluck(:funding_stream).each do |stream|
                  %li
                    = link_to stream, params.merge(:funding_stream => stream), style: 'padding: 7px 15px;'
            %a
              - unless @funding_stream.nil?
                = @funding_stream
              - else
                All

      .uk-alert{'data-uk-alert' => ''}
        %p
          %span.uk-text-bold Tip:
          Hover over the charts to find out more about each of
          = @funder.name.pluralize
          funding rounds.

  .uk-width-small-1-1.uk-medium-1-1.uk-width-large-3-4
    #tab-content.uk-switcher

      .uk-width-1-1.uk-animation-fade
        .uk-grid

          .uk-width-medium-1-3.uk-float-right
            .uk-panel.uk-panel-box.uk-panel-box-primary
              .uk-width-1-1.uk-margin
                .uk-text-bold Mission
                = @funder.mission
              - if @funder.attributes.where("year = ?", (Date.today.year - @years_ago)).any?
                .uk-text-bold Number of grants
                #success_rate{ data: {grants: @funder.attributes.where('year = ?', (Date.today.year - @years_ago)).all.to_json }}
              - if Grant.where('funder_id = ?', @funder).uniq.pluck(:grant_type).any?
                .uk-width-1-1.uk-margin
                  .uk-text-bold Type of funding
                  - Grant.where('funder_id = ?', @funder).uniq.pluck(:grant_type).each do |type|
                    .uk-button.uk-button-primary.uk-button-mini= type
              - if Grant.where('funder_id = ?', @funder).uniq.pluck(:funding_stream).any?
                .uk-width-1-1.uk-margin
                  .uk-text-bold
                    Funding streams
                    %span.uk-text-small
                      = surround '(', ')' do
                        = link_to 'All', params.merge(:funding_stream => nil)
                  - Grant.where('funder_id = ?', @funder).uniq.pluck(:funding_stream).each do |stream|
                    = link_to stream, params.merge(:funding_stream => stream), class: 'uk-button uk-button-primary uk-button-mini'
              - if Grant.where('funder_id = ?', @funder).any?
                .uk-width-1-1.uk-margin
                  .uk-text-bold Funding frequency
                  %span.uk-text-primary.uk-text-bold= funding_frequency(@funder, @years_ago, @funding_stream)
                  times, in
                  = Date.today.year - @years_ago
              - if @funder.attributes.where("year = ?", (Date.today.year - @years_ago)).any?
                .uk-width-1-1.uk-margin
                  .uk-text-bold Application process
                  - @funder.attributes.where("year = ?", (Date.today.year - @years_ago)).first.application_processes.each do |p|
                    .uk-button.uk-button-primary.uk-button-mini= p.label
              - if @funder.attributes.where("year = ?", (Date.today.year - @years_ago)).any?
                .uk-width-1-1.uk-margin
                  .uk-text-bold Application support
                  - @funder.attributes.where("year = ?", (Date.today.year - @years_ago)).first.application_supports.each do |s|
                    .uk-button.uk-button-primary.uk-button-mini= s.label
              - if @funder.attributes.where("year = ?", (Date.today.year - @years_ago)).any?
                .uk-width-1-1.uk-margin
                  .uk-text-bold Level of non-financial support
                  .uk-button.uk-button-primary.uk-button-mini
                    = @funder.attributes.where("year = ?", (Date.today.year - @years_ago)).first.non_financial_support
              - if @funder.attributes.where("year = ?", (Date.today.year - @years_ago)).any?
                .uk-width-1-1.uk-margin
                  .uk-text-bold Reporting requirements
                  - @funder.attributes.where("year = ?", (Date.today.year - @years_ago)).first.reporting_requirements.each do |s|
                    .uk-button.uk-button-primary.uk-button-mini= s.label

          .uk-width-medium-2-3.uk-float-left.uk-margin
            %h2.chart-responsive-margin.uk-margin-bottom-remove Overview
            = render partial: 'recipients/charts/overview/grants_size'

          .uk-width-medium-2-3.uk-float-left
            = render partial: 'recipients/charts/overview/grants_duration'

      .uk-width-1-1.uk-animation-fade
        .uk-grid

          .uk-width-medium-1-3.uk-float-right
            .uk-panel.uk-panel-box.uk-panel-box-primary
              - if @recipient.profiles.pluck(:year).include?(Date.today.year - @years_ago)
                .uk-width-1-1.uk-margin
                  .uk-text-bold Your location
                  .uk-text-primary
                    - @recipient.profiles.where('year = ?', (Date.today.year - @years_ago)).first.districts.each do |d|
                      .uk-button.uk-button-primary.uk-button-mini= d.label
                  - years_ago_result = Date.today.year - @years_ago
                  - if @funder.grants.pluck(:country).any?
                    %table.uk-table.uk-table-condensed
                      %caption= Date.today.year - @years_ago
                      %thead
                        %tr
                          %th Country
                          %th Grants
                      - grants_location(@funder, @funding_stream).each do |k, v|
                        %tbody
                          %tr
                            %td= k
                            %td= v
              - else
                Hey! You don't have a profile for
                = succeed '.' do
                  = Date.today.year - @years_ago
                Why not complete one
                %span.uk-text-bold
                  = link_to 'here', new_recipient_profile_path(@recipient)

          .uk-width-medium-2-3.uk-float-left.uk-margin
            %h2.chart-responsive-margin.uk-margin-bottom-remove Organisation
            = render partial: 'recipients/charts/organisation/grants_location'

          .uk-width-1-1
            .uk-grid

              .uk-width-medium-1-3.uk-float-right
                - if @recipient.profiles.pluck(:year).include?(Date.today.year - @years_ago)
                  .uk-panel.uk-panel-box.uk-panel-box-primary
                    .uk-width-1-1.uk-margin
                      .uk-text-bold Your age
                      - age = ((Date.today - @recipient.founded_on) / 365).to_f.round(1)
                      :javascript
                        window.age = '#{age}';
                      .uk-text-primary
                        %span.uk-text-bold= age
                        years from founding
                      - if @recipient.registered_on?
                        .uk-text-primary
                          %span.uk-text-bold= ((Date.today - @recipient.registered_on) / 365).to_f.round(1)
                          years from registration

              .uk-width-medium-2-3.uk-float-left
                = render partial: 'recipients/charts/organisation/recipient_age'

          .uk-width-1-1.uk-margin-top
            .uk-grid

              .uk-width-medium-1-3.uk-float-right
                - if @recipient.profiles.pluck(:year).include?(Date.today.year - @years_ago)
                  .uk-panel.uk-panel-box.uk-panel-box-primary
                    .uk-width-1-1.uk-margin
                      .uk-text-bold Your income
                      - income = @recipient.profiles.where('year = ?', (Date.today.year - @years_ago)).first.income
                      :javascript
                        window.income = '#{income}';
                      .uk-text-primary
                        %span.uk-text-bold= number_to_currency(@recipient.profiles.where('year = ?', (Date.today.year - @years_ago)).first.income, unit: 'Â£', precision: 0)
                        in
                        = Date.today.year - @years_ago

              .uk-width-medium-2-3.uk-float-left
                = render partial: 'recipients/charts/organisation/recipient_income'
