= content_for :title, "#{@district.district} in #{@funder.current_attribute.year}"

= render partial: 'funders/funding/subnav'

.uk-container.uk-container-center.uk-margin-large
  = render partial: 'funders/prototype'

  %h2= @district.district
  %h4
    In
    = succeed '.' do
      = @funder.current_attribute.year

  .uk-width-large-4-5.uk-container-center.uk-margin-large-top.uk-animation-fade

    %section#most-active-funders.offset
      %ul.insights
        %li
          %strong Indices year:
          = @district.indices_year
        %li
          %strong Indices rank:
          = @district.indices_rank
        %li
          %strong % of residents living in highly deprived areas:
          = number_to_percentage(@district.indices_rank_proportion_most_deprived_ten_percent.to_f * 100, precision: 0)
        %li
          %strong Indices income rank:
          = @district.indices_income_rank
        %li
          %strong Indices income proportion population in 10% most deprived:
          = number_to_percentage(@district.indices_income_proportion_most_deprived_ten_percent.to_f * 100, precision: 0)
        %li
          %strong Indices employment:
          = @district.indices_employment_rank
        %li
          %strong Indices employment proportion population in 10% most deprived:
          = number_to_percentage(@district.indices_employment_proportion_most_deprived_ten_percent.to_f * 100, precision: 0)
        %li
          %strong Indices education:
          = @district.indices_education_rank
        %li
          %strong Indices education proportion population in 10% most deprived:
          = number_to_percentage(@district.indices_education_proportion_most_deprived_ten_percent.to_f * 100, precision: 0)
        %li
          %strong Indices health:
          = @district.indices_health_rank
        %li
          %strong Indices health proportion population in 10% most deprived:
          = number_to_percentage(@district.indices_health_proportion_most_deprived_ten_percent.to_f * 100, precision: 0)
        %li
          %strong Indices crime:
          = @district.indices_crime_rank
        %li
          %strong Indices crime proportion population in 10% most deprived:
          = number_to_percentage(@district.indices_crime_proportion_most_deprived_ten_percent.to_f * 100, precision: 0)
        %li
          %strong Indices income barriers:
          = @district.indices_barriers_rank
        %li
          %strong Indices barriers proportion population in 10% most deprived:
          = number_to_percentage(@district.indices_barriers_proportion_most_deprived_ten_percent.to_f * 100, precision: 0)
        %li
          %strong Indices living:
          = @district.indices_living_rank
        %li
          %strong Indices living proportion population in 10% most deprived:
          = number_to_percentage(@district.indices_living_proportion_most_deprived_ten_percent.to_f * 100, precision: 0)

      %h3.uk-margin-top
        Most active funders
        %span.year.muted
          in
          = @funder.current_attribute.year

      %table.uk-table.uk-table-striped
        %thead
          %tr
            %th Funder
            %th No. of grants
            %th Total amount awarded
            %th % of funded organisations
        %tfoot
          %tr.uk-hidden
            %td Total
            %td= @district.ids_by_grant_count('funder', @funder.current_attribute.year).values.sum
            %td= number_to_currency(Grant.joins(:districts).recent(@funder.current_attribute.year).where('districts.district': @district.district).sum(:amount_awarded), unit: '£', precision: 0)
        %tbody
          - @district.ids_by_grant_count('funder', @funder.current_attribute.year).each_with_index do |(k, v), i|
            %tr{class: ('uk-hidden' if i > 4)}
              %td= Funder.find(k).name
              %td= v
              %td= number_to_currency(Funder.find(k).recent_grants(@funder.current_attribute.year).joins(:districts).where('districts.district': @district.district).sum(:amount_awarded), unit: '£', precision: 0)
              %td
                = number_to_percentage((v.to_f / Funder.find(k).recent_grants(@funder.current_attribute.year).count.to_f)*100, precision: 1)

      .uk-text-center
        %a.uk-button.uk-button-primary.uk-button-small.show-more Show more

    %hr.thick

    %section#summary.offset
      %h3.uk-margin-top
        Most funded organisations
        %span.year.muted
          in
          = @funder.current_attribute.year

      %table.uk-table.uk-table-striped
        %thead
          %tr
            %th Funder
            %th Total amount awarded
            %th No. of grants
        %tbody
          - @district.ids_by_grant_sum('recipient', @funder.current_attribute.year).each_with_index do |(k, v), i|
            %tr{class: ('uk-hidden' if i > 4)}
              %td= Recipient.find(k).name
              %td= number_to_currency(v, unit: '£', precision: 0)
              %td= @district.ids_by_grant_count('recipient', @funder.current_attribute.year)[k]

      .uk-text-center
        %a.uk-button.uk-button-primary.uk-button-small.show-more Show more

    %ul
      %li Top funded organisation
      %li Top funded beneficiaries
      %li Type of funding
      %li Type of funding requested
      %li IMD data
      %li Funding amount
      %li Funding duration
      %li By cause/theme - from funding streams
